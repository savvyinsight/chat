<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Chat WS Demo</title>
</head>
<body>
  <h3>WebSocket Demo</h3>
  <label>Server URL: <input id="url" value="ws://localhost:8080/ws" style="width:400px"/></label><br/>
  <label>Token (or empty to use ?user_id): <input id="token" style="width:400px"/></label><br/>
  <label>User ID (dev fallback): <input id="user" style="width:80px"/></label><br/>
  <button id="connect">Connect</button>
  <button id="disconnect">Disconnect</button>
  <div>
    <textarea id="log" rows="10" cols="80" readonly></textarea>
  </div>
  <div>
    <input id="msg" style="width:400px"/>
    <button id="send">Send</button>
  </div>
  <script>
    let ws;
    const log = (s) => { document.getElementById('log').value += s + '\n'; };
    document.getElementById('connect').onclick = () => {
      let url = document.getElementById('url').value;
      const token = document.getElementById('token').value.trim();
      const uid = document.getElementById('user').value.trim();
      if (token) {
        url += '?token=' + encodeURIComponent(token);
      } else if (uid) {
        url += '?user_id=' + encodeURIComponent(uid);
      }
      ws = new WebSocket(url);
      ws.onopen = () => log('connected');
      ws.onmessage = (ev) => log('recv: ' + ev.data);
      ws.onclose = () => log('closed');
      ws.onerror = (e) => log('error: ' + e);
    };
    document.getElementById('disconnect').onclick = () => { if (ws) ws.close(); };
    document.getElementById('send').onclick = () => {
      const m = document.getElementById('msg').value;
      if (!ws) { log('not connected'); return; }
      const payload = {type:'message', body: m};
      ws.send(JSON.stringify(payload));
      log('sent: ' + JSON.stringify(payload));
    };
  </script>
</body>
</html>
